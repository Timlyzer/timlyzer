# 功能需求规格

## 1. 概述

本文档定义 Timlyzer 的功能需求，参考 Tockler 原版功能并进行优化。

## 2. 核心功能

### 2.1 自动时间追踪

#### 2.1.1 应用追踪 (App Tracking)

**描述**: 自动记录用户使用的应用程序和窗口标题。

**功能需求**:

| ID    | 需求                                  | 优先级 |
| ----- | ------------------------------------- | ------ |
| AT-01 | 后台自动检测当前活动窗口              | P0     |
| AT-02 | 记录应用名称、窗口标题、开始/结束时间 | P0     |
| AT-03 | 支持自定义轮询间隔（默认 3 秒）       | P1     |
| AT-04 | 检测 URL（浏览器使用）                | P2     |
| AT-05 | 应用图标获取和显示                    | P2     |

**数据结构**:

```typescript
interface AppTrackItem {
  id: number;
  app: string; // 应用名称
  title: string; // 窗口标题
  url?: string; // URL (如适用)
  beginDate: number; // 开始时间戳 (ms)
  endDate: number; // 结束时间戳 (ms)
  color?: string; // 显示颜色
}
```

#### 2.1.2 状态追踪 (Status Tracking)

**描述**: 追踪电脑状态（在线、空闲、离线）。

**功能需求**:

| ID    | 需求                              | 优先级 |
| ----- | --------------------------------- | ------ |
| ST-01 | 检测系统空闲状态                  | P0     |
| ST-02 | 检测系统休眠/唤醒事件             | P0     |
| ST-03 | 记录状态变化时间段                | P0     |
| ST-04 | 支持自定义空闲阈值（默认 5 分钟） | P1     |
| ST-05 | 空闲期间停止应用追踪              | P0     |

**状态类型**:

| 状态        | 说明             |
| ----------- | ---------------- |
| **ONLINE**  | 用户正在使用电脑 |
| **IDLE**    | 电脑空闲超过阈值 |
| **OFFLINE** | 电脑休眠或关机   |

#### 2.1.3 手动任务追踪 (Log Tracking)

**描述**: 用户手动创建和管理任务。

**功能需求**:

| ID    | 需求                               | 优先级 |
| ----- | ---------------------------------- | ------ |
| LT-01 | 创建新任务并开始计时               | P1     |
| LT-02 | 停止当前运行的任务                 | P1     |
| LT-03 | 切换任务（停止旧任务，开始新任务） | P1     |
| LT-04 | 编辑任务信息（名称、颜色）         | P1     |
| LT-05 | 删除任务记录                       | P1     |
| LT-06 | 任务快速选择（从历史任务列表）     | P2     |

### 2.2 时间线可视化

**描述**: 以图表形式展示时间使用情况。

**功能需求**:

| ID    | 需求                         | 优先级 |
| ----- | ---------------------------- | ------ |
| TL-01 | 显示今日时间线               | P0     |
| TL-02 | 三轨道设计（任务/状态/应用） | P0     |
| TL-03 | 支持缩放和平移               | P0     |
| TL-04 | 点击追踪项查看详情           | P1     |
| TL-05 | 日期选择器切换日期           | P1     |
| TL-06 | 实时更新（5 秒刷新）         | P1     |
| TL-07 | 支持编辑追踪项               | P2     |
| TL-08 | 支持合并追踪项               | P3     |

**UI 组件**:

```
┌─────────────────────────────────────────────────────────────┐
│  ◀ 2026-01-01 ▶                            [Today] [Live]  │
├─────────────────────────────────────────────────────────────┤
│ Task   │██████ Meeting ████│░░░░│█████ Coding ██████│       │
│ Status │████ Online ███████████████████████████████│░Idle░│ │
│ App    │█Chrome█│███VSCode███████████│█Slack█│███VSCode███│ │
├─────────────────────────────────────────────────────────────┤
│ 09:00   10:00   11:00   12:00   13:00   14:00   15:00   Now │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 统计与报表

#### 2.3.1 应用使用统计

| ID    | 需求                    | 优先级 |
| ----- | ----------------------- | ------ |
| US-01 | 应用使用时长饼图        | P1     |
| US-02 | 今日/本周/本月使用统计  | P1     |
| US-03 | 按应用/标题分组         | P1     |
| US-04 | 趋势对比（与上周/上月） | P2     |

#### 2.3.2 日历视图

| ID    | 需求             | 优先级 |
| ----- | ---------------- | ------ |
| CV-01 | 日历热力图显示   | P2     |
| CV-02 | 点击日期查看详情 | P2     |
| CV-03 | 在线时长统计     | P2     |

### 2.4 搜索功能

| ID    | 需求           | 优先级 |
| ----- | -------------- | ------ |
| SE-01 | 按应用名称搜索 | P1     |
| SE-02 | 按窗口标题搜索 | P1     |
| SE-03 | 按日期范围筛选 | P1     |
| SE-04 | 按追踪类型筛选 | P1     |
| SE-05 | 搜索结果分页   | P1     |
| SE-06 | 搜索结果排序   | P2     |

### 2.5 数据导出

| ID    | 需求               | 优先级 |
| ----- | ------------------ | ------ |
| EX-01 | 导出为 CSV 格式    | P1     |
| EX-02 | 导出为 JSON 格式   | P2     |
| EX-03 | 自定义导出时间范围 | P1     |
| EX-04 | 自定义导出字段     | P3     |

### 2.6 设置

#### 2.6.1 通用设置

| ID    | 需求              | 优先级 |
| ----- | ----------------- | ------ |
| GS-01 | 深色/浅色主题切换 | P1     |
| GS-02 | 开机自启动        | P1     |
| GS-03 | 最小化到托盘      | P1     |
| GS-04 | 语言设置          | P3     |

#### 2.6.2 追踪设置

| ID    | 需求         | 优先级 |
| ----- | ------------ | ------ |
| TS-01 | 轮询间隔设置 | P1     |
| TS-02 | 空闲阈值设置 | P1     |
| TS-03 | 忽略特定应用 | P2     |

#### 2.6.3 应用颜色设置

| ID    | 需求                 | 优先级 |
| ----- | -------------------- | ------ |
| CS-01 | 为应用设置自定义颜色 | P1     |
| CS-02 | 自动生成默认颜色     | P1     |
| CS-03 | 批量颜色管理         | P3     |

### 2.7 系统托盘

| ID    | 需求                       | 优先级 |
| ----- | -------------------------- | ------ |
| TR-01 | 显示托盘图标               | P0     |
| TR-02 | 托盘菜单（打开/设置/退出） | P0     |
| TR-03 | 托盘弹出窗口（快速查看）   | P1     |
| TR-04 | 显示当前任务状态           | P1     |
| TR-05 | 快速开始/停止任务          | P2     |

### 2.8 通知系统

| ID    | 需求           | 优先级 |
| ----- | -------------- | ------ |
| NO-01 | 休息提醒通知   | P2     |
| NO-02 | 自定义提醒间隔 | P2     |
| NO-03 | 长时间使用提醒 | P3     |

## 3. 非功能需求

### 3.1 性能

| ID    | 需求               | 指标     |
| ----- | ------------------ | -------- |
| PF-01 | 冷启动时间         | < 2 秒   |
| PF-02 | 内存占用           | < 100 MB |
| PF-03 | CPU 占用（空闲时） | < 1%     |
| PF-04 | 打包大小           | < 30 MB  |

### 3.2 安全

| ID    | 需求                       |
| ----- | -------------------------- |
| SC-01 | 数据本地存储，不上传到云端 |
| SC-02 | 使用 SQLite 加密（可选）   |
| SC-03 | 遵循最小权限原则           |

### 3.3 可用性

| ID    | 需求                           |
| ----- | ------------------------------ |
| UA-01 | 响应式布局（适应不同窗口大小） |
| UA-02 | 键盘快捷键支持                 |
| UA-03 | 清晰的错误提示                 |

### 3.4 兼容性

| ID    | 需求                       |
| ----- | -------------------------- |
| CM-01 | macOS 10.15+ (Catalina+)   |
| CM-02 | Windows 10+                |
| CM-03 | Ubuntu 20.04+ / Fedora 37+ |

## 4. 用户故事

### US-001: 自动追踪工作时间

> 作为一名开发者，我希望应用能自动记录我使用各个应用的时间，这样我可以了解自己的工作习惯。

**验收标准**:

- 应用启动后自动开始追踪
- 正确识别应用名称和窗口标题
- 应用切换时正确记录时间段

### US-002: 查看每日时间线

> 作为用户，我希望能看到今天的时间线图表，这样我能直观地了解时间分配。

**验收标准**:

- 显示今日从 00:00 到 24:00 的时间线
- 分三轨道显示任务、状态、应用
- 支持缩放查看细节

### US-003: 手动记录任务

> 作为项目经理，我希望能手动记录特定任务（如"会议"），这样我可以追踪不在电脑前的活动。

**验收标准**:

- 可以创建新任务并开始计时
- 可以停止或切换任务
- 任务显示在时间线的任务轨道

### US-004: 查看统计报表

> 作为用户，我希望看到本周的应用使用统计，这样我能了解哪些应用占用了最多时间。

**验收标准**:

- 饼图显示各应用占比
- 可切换日/周/月视图
- 显示使用时长数字

### US-005: 搜索历史记录

> 作为用户，我希望能搜索特定时间段内与某个项目相关的活动记录。

**验收标准**:

- 可以按关键词搜索标题
- 可以筛选日期范围
- 结果分页显示

## 5. MVP 版本范围

### 包含 (P0 + P1):

1. ✅ 自动应用追踪
2. ✅ 系统状态追踪
3. ✅ 时间线可视化
4. ✅ 系统托盘
5. ✅ 基础设置
6. ✅ 应用使用统计
7. ✅ 搜索功能
8. ✅ CSV 导出

### 延后 (P2 + P3):

1. ⏳ 手动任务追踪
2. ⏳ 日历视图
3. ⏳ 休息提醒
4. ⏳ 忽略应用规则
5. ⏳ 多语言

---

_文档最后更新: 2026-01-01_
